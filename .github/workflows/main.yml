name: ditzz RDP via Tailscale

on:
  workflow_dispatch:

jobs:
  rdp-session:
    name: Deploy ditzz RDP Session
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Validate Secrets
        shell: powershell
        run: |
          if (-not "${{ secrets.TAILSCALE_AUTH_KEY }}") {
            Write-Error "FATAL: Secret 'TAILSCALE_AUTH_KEY' not found. Please set it in repository Settings > Secrets and variables > Actions."
            exit 1
          }

      - name: Execute ditzz Deployment Script
        shell: powershell
        run: |
          $scriptUrl = "https://gist.githubusercontent.com/ditzz-dev/24c4253178c7b7018357b6393e2d505f/raw/fdcc276d3b23e8cfb54301edf104534cecf920bf/devnest-win11.ps1"
          Invoke-WebRequest -Uri $scriptUrl -OutFile "deploy.ps1"
          .\deploy.ps1 -TailscaleAuthKey "${{ secrets.TAILSCALE_AUTH_KEY }}"
